# Plugin Info
version: 0.0.3
title: Syslog
description: Log parser for Syslog
parameters:
  - name: listen_address
    label: Listen Address
    description: A syslog address of the form `<ip>:<port>`
    type: string
    default: "0.0.0.0:514"
  - name: connection_type
    label: Connection Type
    description: The type of syslog connection (`udp` or `tcp`)
    type: enum
    valid_values:
      - udp
      - tcp
    default: udp
  - name: protocol
    label: Protocol
    description: The protocol of received syslog messages (`rfc3164` or `rfc5424`)
    type: enum
    valid_values:
      - rfc3164 (BSD)
      - rfc5424 (IETF)
    default: rfc5424 (IETF)

# Set Defaults
# {{$listen_address := default "0.0.0.0:514" .listen_address}}
# {{$connection_type := default "udp" .connection_type}}
# {{$protocol := default "rfc5424" .protocol}}

# Pipeline Template
pipeline:
# {{ if eq $connection_type "udp" }}
  - id: syslog_input
    type: udp_input
    listen_address: {{ $listen_address }}
    labels:
      log_type: syslog
      plugin_id: {{ .id }}
    output: syslog_parser
# {{ end }}

# {{ if eq $connection_type "tcp" }}
  - id: syslog_input
    type: tcp_input
    listen_address: {{ $listen_address }}
    labels:
      log_type: syslog
      plugin_id: {{ .id }}
    output: syslog_parser
# {{ end }}

  - id: syslog_parser
    type: syslog_parser
    protocol: {{ $protocol }}
    output: {{ .output }}
