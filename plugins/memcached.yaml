# Plugin Info
version: 0.0.2
title: Memcached
description: Log parser for Memcached
parameters:
  - name: memcached_journald_log_path
    label: Memcached Journald Log Path
    description: 'Memcached Journald Log path. It will read from /run/journal or /var/log/journal if this parameter is omitted'
    type: string
  - name: start_at
    label: Start At
    description: Start reading file from 'beginning' or 'end'
    type: enum
    valid_values:
      - beginning
      - end
    default: end

# Set Defaults
# {{$start_at := default "end" .start_at}}

# Pipeline Template
pipeline:
  - id: memcached_journald_input
    type: journald_input
    # {{ if .memcached_journald_log_path }}
    directory: '{{ .memcached_journald_log_path }}'
    # {{ end }}
    start_at: {{ $start_at }}
    labels:
      log_type: memcached
      plugin_id: {{ .id }}

  - id: memcached_filter
    type: filter
    expr: '$record._SYSTEMD_UNIT != "memcached.service"'

  - type: severity_parser
    parse_from: $record.PRIORITY
    mapping:
      emergency: 0
      alert: 1
      critical: 2
      error: 3
      warning: 4
      notice: 5
      info: 6
      debug: 7
    output: {{ .output }}
